<!-- chat/templates/chat/room.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>smart mirror</title>
    <link rel="stylesheet" href="{% static 'main.css' %}">
    <link rel="stylesheet" href="{% static 'clock.css' %}" />
    <script src="main.js"></script>
    <script src="timer.js"></script>
    <script src="timeout.js"></script>
</head>
<body id='box' class='box'>
    <div id='container' class='container'>
        <div id="date" class="date"></div>
        <div id="time" class="time">
            
        </div>
        <h1 class = "h1-clock"></h1>
        <div id='timer' class='timer'></div>
        </div>
    </div>
    <script src = "clock.js"></script>

    {{ room_name|json_script:"room-name" }}
    <script>
        const roomName = JSON.parse(document.getElementById('room-name').textContent);

        const mirrorSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/mirror/'
            + roomName
            + '/'
        );


        var time = 0; //기준시간 작성
        var stopWatchTime = 0;
        var isOpen = 0;
        var response = 0
        var min = ""; //분
        var sec = ""; //초
        mirrorSocket.onmessage = function(e)  {
            const data = JSON.parse(e.data);
            time = parseInt(data.time);
            isOpen = parseInt(data.isOpen); // 0 or 1
            response = parseInt(data.response); // 0 or 1
        }

        function sendResponse() {
            // http 요청
            // 내용은 현재 stopWatch 값
            stopWatchTime = 0;
            time = 0;
            response = 0;
            document.getElementById('box').style.backgroundColor = 'white';
            document.getElementById("timer").innerHTML = '';

        }
        
        function timer() {
        //parseInt() : 정수를 반환
        min = parseInt(time/60); //몫을 계산
        sec = time%60; //나머지를 계산

        document.getElementById("timer").innerHTML = min + "분" + sec + "초";
        if(time >= 0){
            time--;
        }

        //타임아웃 시
	  if (time < 300) {
        document.getElementById('box').style.backgroundColor = 'orange';
      }
      if (time < 295) {
        document.getElementById('box').style.backgroundColor = 'black';
      }
	  if (time < 180) {
        document.getElementById('box').style.backgroundColor = 'orange';
      }
      if (time < 175) {
        document.getElementById('box').style.backgroundColor = 'black';
      }
      if (time < 60) {
        document.getElementById('box').style.backgroundColor = 'red';
      }
      if (time < 55) {
        document.getElementById('box').style.backgroundColor = 'black';
      }
      if (time < 30) {
        document.getElementById('box').style.backgroundColor = 'red';
      }
      if (time < 25) {
        document.getElementById('box').style.backgroundColor = 'black';
      }
      if (time < 10) {
        document.getElementById('box').style.backgroundColor = 'red';
      }
      if (time < 5) {
        document.getElementById('box').style.backgroundColor = 'black';
      }
        }

        function stopWatch() {
            stopWatchTime++;
        }

        const clock = document.querySelector('.h1-clock');


        function getTime(){
        const time = new Date();
        const hour = time.getHours();
        const minutes = time.getMinutes();
        const seconds = time.getSeconds();
        clock.innerHTML = `${hour<10 ? `0${hour}`:hour}:${minutes<10 ? `0${minutes}`:minutes}:${seconds<10 ? `0${seconds}`:seconds}`
}       
        console.log(time);
        console.log(isOpen);
        console.log(response);
        //setInterval(함수, 시간) : 주기적인 실행
        setInterval(function(){
            isOpen ? timer() : {};
            isOpen ? stopWatch() : {};
            getTime();
            response ? sendResponse() : {};

            console.log(time);
        console.log(isOpen);
        console.log(response);
        console.log(stopWatchTime)
        }, 1000);


    </script>
</body>
</html>

<!--  -->

<!-- const chatSocket = new WebSocket(
    'ws://'
    + window.location.host
    + '/ws/mirror/'
    + roomName
    + '/'
);

chatSocket.send(JSON.stringify({
    'message': message
})); -->